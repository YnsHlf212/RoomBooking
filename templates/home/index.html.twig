{% extends 'base.html.twig' %}

{% block title %}Tableau de bord ‚Äî RoomBooking{% endblock %}

{% block body %}

    {# ====== HERO ====== #}
    <div class="hero">
        <h1>Bonjour, {{ app.user.firstName }} üëã</h1>
        <p>
            {% if is_granted('ROLE_ADMIN') %}
                Vous √™tes administrateur ‚Äî acc√®s complet √† l'application.
            {% elseif is_granted('ROLE_COORDINATOR') %}
                Vous √™tes coordinateur ‚Äî g√©rez vos classes et r√©servations.
            {% else %}
                Bienvenue sur RoomBooking ‚Äî r√©servez vos salles facilement.
            {% endif %}
        </p>
    </div>

    {# ====== STATS ADMIN ====== #}
    {% if is_granted('ROLE_ADMIN') and stats is not empty %}
        <div class="dashboard-cards" style="margin-bottom:2rem;">
            <div class="card" style="text-align:center;">
                <h2 style="font-size:2.5rem; color:#2563eb; margin-bottom:0.25rem;">
                    {{ stats.totalRooms }}
                </h2>
                <p style="margin:0;">Salles actives</p>
            </div>
            <div class="card" style="text-align:center;">
                <h2 style="font-size:2.5rem; color:#16a34a; margin-bottom:0.25rem;">
                    {{ stats.totalReservations }}
                </h2>
                <p style="margin:0;">R√©servations totales</p>
            </div>
            <div class="card" style="text-align:center;">
                <h2 style="font-size:2.5rem; color:#d97706; margin-bottom:0.25rem;">
                    {{ stats.todayReservations }}
                </h2>
                <p style="margin:0;">R√©servations aujourd'hui</p>
            </div>
        </div>
    {% endif %}

    {# ====== ACTIONS RAPIDES ====== #}
    <div class="dashboard-cards" style="margin-bottom:2rem;">
        <div class="card">
            <h2>üìÖ Nouvelle r√©servation</h2>
            <p>R√©servez rapidement une salle disponible.</p>
            <a href="{{ path('app_reservation_new') }}" class="btn btn-primary">R√©server</a>
        </div>

        <div class="card">
            <h2>üè† Salles disponibles</h2>
            <p>{{ availableRooms|length }} salle(s) active(s) dans l'√©tablissement.</p>
            <a href="{{ path('app_room_index') }}" class="btn">Voir les salles</a>
        </div>

        {% if is_granted('ROLE_ADMIN') %}
            <div class="card card-admin">
                <h2>‚öôÔ∏è Administration</h2>
                <p>G√©rez les salles, utilisateurs et promotions.</p>
                <a href="{{ path('app_admin_dashboard') }}" class="btn btn-admin">Acc√©der</a>
            </div>
        {% endif %}

        {% if is_granted('ROLE_COORDINATOR') %}
            <div class="card">
                <h2>üë• Mes classes</h2>
                <p>Consultez et g√©rez vos promotions.</p>
                <a href="{{ path('app_coordinator_dashboard') }}" class="btn">Voir mes classes</a>
            </div>
        {% endif %}
    </div>

    {# ====== R√âSERVATIONS √Ä VENIR ====== #}
    <div style="margin-bottom:2rem;">
        <div class="page-header">
            <h2>üìÜ Mes prochaines r√©servations</h2>
            <a href="{{ path('app_reservation_index') }}" class="btn">Voir tout</a>
        </div>

        {% if upcomingReservations|length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th>Salle</th>
                        <th>D√©but</th>
                        <th>Fin</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reservation in upcomingReservations %}
                        <tr>
                            <td>üè† {{ reservation.room.name }}</td>
                            <td>{{ reservation.startDatetime|date('d/m/Y H:i') }}</td>
                            <td>{{ reservation.endDatetime|date('d/m/Y H:i') }}</td>
                            <td>
                                <form method="post"
                                      action="{{ path('app_reservation_delete', {'id': reservation.id}) }}"
                                      data-confirm="Annuler cette r√©servation ?">
                                    <input type="hidden" name="_token"
                                           value="{{ csrf_token('delete' ~ reservation.id) }}">
                                    <button type="submit" class="btn btn-danger">‚ùå Annuler</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <div class="card" style="text-align:center; padding:2rem;">
                <p style="color:#64748b; margin-bottom:1rem;">Aucune r√©servation √† venir.</p>
                <a href="{{ path('app_reservation_new') }}" class="btn btn-primary">
                    + Cr√©er une r√©servation
                </a>
            </div>
        {% endif %}
    </div>

    {# ====== R√âSERVATIONS PASS√âES ====== #}
    {% if pastReservations|length > 0 %}
        <div>
            <div class="page-header">
                <h2>üïê Historique r√©cent</h2>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Salle</th>
                        <th>D√©but</th>
                        <th>Fin</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reservation in pastReservations %}
                        <tr>
                            <td>üè† {{ reservation.room.name }}</td>
                            <td>{{ reservation.startDatetime|date('d/m/Y H:i') }}</td>
                            <td>{{ reservation.endDatetime|date('d/m/Y H:i') }}</td>
                            <td>
                                {% if reservation.cancelledAt %}
                                    <span style="color:#dc2626;">‚ùå Annul√©e</span>
                                {% else %}
                                    <span style="color:#64748b;">‚è± Termin√©e</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}

{% endblock %}